<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
  <title>EVE Live Brain // CEC-WAM Interface</title>

  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@600;800;900&family=Rajdhani:wght@400;600;700&family=Share+Tech+Mono&display=swap" rel="stylesheet">

  <style>
    :root{
      --cyan:#00f3ff;
      --cyan2:#00cfe0;
      --purple:#bc13fe;
      --gold:#ffd700;
      --green:#33ff66;
      --red:#ff3355;

      --bg:#02050a;
      --panel:rgba(8,14,20,.78);
      --panel2:rgba(8,14,20,.90);
      --border:rgba(0,243,255,.30);
      --borderSoft:rgba(0,243,255,.18);
      --shadow:0 0 22px rgba(0,243,255,.14);

      --fontHead: Orbitron, system-ui, sans-serif;
      --fontUI: Rajdhani, system-ui, sans-serif;
      --fontMono: "Share Tech Mono", ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", monospace;
    }

    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0;
      background: radial-gradient(1200px 700px at 30% 10%, rgba(0,243,255,.10), transparent 55%),
                  radial-gradient(900px 600px at 80% 20%, rgba(188,19,254,.10), transparent 60%),
                  var(--bg);
      color:#e9fbff;
      font-family:var(--fontUI);
      overflow:hidden;
    }

    /* Star map canvas */
    #starmap{
      position:fixed; inset:0;
      z-index:0;
      opacity:.55;
      pointer-events:none;
    }

    /* Subtle scanline */
    .scanline{
      position:fixed; left:0; right:0; height:2px;
      background:rgba(0,243,255,.22);
      filter:blur(.2px);
      animation:scan 6s linear infinite;
      z-index:4;
      pointer-events:none;
    }
    @keyframes scan { 0%{top:-10%} 100%{top:110%} }

    /* Layout */
    .app{
      position:relative;
      z-index:2;
      height:100%;
      display:flex;
      flex-direction:column;
    }

    .header{
      padding:18px 16px 12px;
      border-bottom:1px solid rgba(0,243,255,.18);
      background:linear-gradient(to bottom, rgba(0,0,0,.78), rgba(0,0,0,.35));
      backdrop-filter: blur(6px);
    }

    .toprow{
      display:flex;
      gap:12px;
      align-items:flex-end;
      justify-content:space-between;
    }

    .title{
      display:flex;
      flex-direction:column;
      gap:6px;
    }
    .title h1{
      margin:0;
      font-family:var(--fontHead);
      font-size:28px;
      letter-spacing:.04em;
      font-weight:900;
      line-height:1;
    }
    .title .sub{
      font-size:12px;
      color:rgba(233,251,255,.70);
      letter-spacing:.12em;
      text-transform:uppercase;
    }

    .statsRow{
      display:flex;
      gap:16px;
      align-items:flex-end;
      justify-content:flex-end;
      flex-wrap:wrap;
      text-align:right;
      font-family:var(--fontMono);
    }
    .statBox{
      padding:10px 12px;
      border:1px solid var(--borderSoft);
      background:rgba(0,0,0,.28);
      box-shadow:var(--shadow);
      border-radius:14px;
      min-width:160px;
    }
    .statLabel{
      font-size:10px;
      color:rgba(233,251,255,.65);
      letter-spacing:.18em;
      text-transform:uppercase;
    }
    .statValue{
      font-size:18px;
      font-weight:800;
      margin-top:2px;
      color:#fff;
    }
    .statusLine{
      margin-top:8px;
      display:flex;
      justify-content:space-between;
      gap:10px;
      font-family:var(--fontMono);
      font-size:11px;
      color:rgba(233,251,255,.70);
    }
    .pill{
      border:1px solid var(--borderSoft);
      background:rgba(0,0,0,.25);
      padding:6px 10px;
      border-radius:999px;
      display:inline-flex;
      align-items:center;
      gap:8px;
      white-space:nowrap;
    }
    .dot{width:8px;height:8px;border-radius:50%}
    .dot.green{background:var(--green); box-shadow:0 0 12px rgba(51,255,102,.35)}
    .dot.cyan{background:var(--cyan); box-shadow:0 0 12px rgba(0,243,255,.35)}
    .dot.purple{background:var(--purple); box-shadow:0 0 12px rgba(188,19,254,.35)}

    .tabs{
      display:flex;
      gap:10px;
      padding:10px 12px;
      border-bottom:1px solid rgba(0,243,255,.14);
      overflow:auto;
      background:rgba(0,0,0,.22);
      backdrop-filter: blur(6px);
      -webkit-overflow-scrolling:touch;
    }
    .tab{
      border:1px solid rgba(0,243,255,.18);
      background:rgba(6,10,16,.55);
      color:rgba(233,251,255,.85);
      padding:10px 12px;
      border-radius:12px;
      font-family:var(--fontUI);
      font-weight:700;
      letter-spacing:.06em;
      white-space:nowrap;
      cursor:pointer;
      user-select:none;
    }
    .tab small{opacity:.75;font-weight:600}
    .tab.active{
      border-color:rgba(0,243,255,.55);
      box-shadow:0 0 18px rgba(0,243,255,.14);
      color:#fff;
    }

    .main{
      flex:1;
      overflow:auto;
      padding:14px 12px 120px;
      -webkit-overflow-scrolling:touch;
    }

    .panel{
      background:var(--panel);
      border:1px solid var(--border);
      box-shadow:var(--shadow);
      border-radius:18px;
      padding:16px;
      margin-bottom:14px;
    }
    .panel h2{
      margin:0 0 10px 0;
      font-family:var(--fontHead);
      font-size:22px;
      letter-spacing:.03em;
    }
    .muted{color:rgba(233,251,255,.70)}
    .grid2{
      display:grid;
      grid-template-columns:repeat(2, minmax(0,1fr));
      gap:12px;
    }
    @media (max-width:820px){ .grid2{grid-template-columns:1fr} }

    .metricBig{
      display:grid;
      grid-template-columns: 1fr auto;
      gap:10px;
      align-items:end;
    }
    .metricBig .k{font-size:14px;color:rgba(233,251,255,.75);letter-spacing:.08em}
    .metricBig .v{font-size:42px;font-weight:900;color:#fff;line-height:1}
    .metricBig .s{font-size:14px;color:rgba(233,251,255,.70)}
    .metricLine{
      display:flex; justify-content:space-between; gap:10px;
      font-family:var(--fontMono);
      padding:8px 0;
      border-top:1px solid rgba(0,243,255,.10);
      color:rgba(233,251,255,.85);
    }
    .metricLine:first-of-type{border-top:0}

    /* Donut gauge (no external libraries) */
    .donutWrap{display:flex; gap:14px; align-items:center; justify-content:space-between; flex-wrap:wrap}
    .donut{
      --p:50;
      width:220px; height:220px;
      border-radius:50%;
      background:
        conic-gradient(var(--cyan) calc(var(--p)*1%), rgba(233,251,255,.14) 0);
      position:relative;
      box-shadow:0 0 22px rgba(0,243,255,.10);
    }
    .donut:after{
      content:"";
      position:absolute; inset:18px;
      border-radius:50%;
      background:rgba(0,0,0,.50);
      border:1px solid rgba(0,243,255,.18);
      box-shadow: inset 0 0 24px rgba(0,0,0,.65);
    }
    .donutCenter{
      position:absolute; inset:0;
      display:flex; flex-direction:column;
      align-items:center; justify-content:center;
      z-index:2;
      font-family:var(--fontHead);
      letter-spacing:.06em;
    }
    .donutCenter .pct{font-size:42px;color:#fff;font-weight:900}
    .donutCenter .lbl{font-size:12px;color:rgba(233,251,255,.75);font-family:var(--fontMono)}
    .legend{
      display:flex; flex-direction:column; gap:8px;
      font-family:var(--fontMono);
      font-size:12px;
      min-width:220px;
    }
    .legendRow{display:flex; justify-content:space-between; gap:10px; padding:8px 10px; border:1px solid rgba(0,243,255,.12); border-radius:12px; background:rgba(0,0,0,.22)}
    .swatch{display:inline-block; width:12px; height:12px; border-radius:3px; margin-right:8px; vertical-align:-2px}

    /* Ship blueprint card */
    .card{
      background:rgba(0,0,0,.26);
      border:1px solid rgba(0,243,255,.18);
      border-radius:16px;
      padding:14px;
    }
    .cardTitle{
      display:flex; align-items:center; justify-content:space-between; gap:10px;
      font-family:var(--fontHead);
      letter-spacing:.04em;
      font-size:18px;
      margin-bottom:10px;
    }
    .tag{
      font-family:var(--fontMono);
      font-size:10px;
      letter-spacing:.12em;
      padding:6px 8px;
      border-radius:999px;
      border:1px solid rgba(0,243,255,.18);
      background:rgba(0,0,0,.24);
      color:rgba(233,251,255,.78);
      text-transform:uppercase;
      white-space:nowrap;
    }
    .media{
      border-radius:14px;
      border:1px solid rgba(0,243,255,.14);
      background:rgba(0,0,0,.22);
      overflow:hidden;
      position:relative;
      aspect-ratio: 16 / 9;
      margin-bottom:10px;
    }
    .media img{
      width:100%; height:100%; object-fit:cover;
      display:none; /* shown only if it loads */
    }
    .bp{
      position:absolute; inset:0;
      display:flex; align-items:center; justify-content:center;
      background:
        radial-gradient(circle at 20% 30%, rgba(0,243,255,.16), transparent 50%),
        linear-gradient(180deg, rgba(0,0,0,.25), rgba(0,0,0,.55));
    }
    .bp svg{width:100%; height:100%; opacity:.95}
    .desc{color:rgba(233,251,255,.80); line-height:1.35}
    .desc b{color:#fff}

    /* Timeline table */
    table{width:100%; border-collapse:collapse; font-family:var(--fontMono); font-size:12px}
    th,td{padding:10px 8px; border-bottom:1px solid rgba(0,243,255,.12); text-align:left}
    th{color:rgba(233,251,255,.80); letter-spacing:.12em; text-transform:uppercase; font-size:10px}
    td{color:rgba(233,251,255,.85)}
    .statusOK{color:var(--green); font-weight:800}
    .statusInfo{color:var(--cyan); font-weight:800}
    .statusWarn{color:var(--gold); font-weight:800}

    /* EVE Console */
    .consoleWrap{
      display:grid;
      grid-template-columns: 1fr;
      gap:12px;
    }
    .log{
      height:280px;
      overflow:auto;
      border-radius:16px;
      border:1px solid rgba(0,243,255,.18);
      background:rgba(0,0,0,.35);
      padding:12px;
      font-family:var(--fontMono);
      font-size:12px;
      line-height:1.35;
    }
    .logLine{margin:0 0 8px 0}
    .ts{color:rgba(233,251,255,.45)}
    .srcSYS{color:rgba(233,251,255,.70)}
    .srcEVE{color:var(--purple); font-weight:900}
    .srcYOU{color:var(--cyan); font-weight:900}
    .srcERR{color:var(--red); font-weight:900}

    .inputRow{
      display:flex; gap:10px; align-items:center;
      flex-wrap:wrap;
    }
    .inputRow input{
      flex:1;
      min-width:220px;
      border-radius:14px;
      border:1px solid rgba(0,243,255,.20);
      background:rgba(0,0,0,.40);
      color:#fff;
      padding:12px 12px;
      font-family:var(--fontMono);
      font-size:13px;
      outline:none;
    }
    .btn{
      border-radius:14px;
      border:1px solid rgba(0,243,255,.22);
      background:rgba(0,0,0,.28);
      color:#fff;
      padding:12px 12px;
      font-family:var(--fontMono);
      cursor:pointer;
      letter-spacing:.08em;
      text-transform:uppercase;
      font-size:11px;
      white-space:nowrap;
    }
    .btn.primary{border-color:rgba(0,243,255,.55); box-shadow:0 0 18px rgba(0,243,255,.14)}
    .btn.danger{border-color:rgba(255,51,85,.55); box-shadow:0 0 18px rgba(255,51,85,.14)}
    .btn:active{transform:scale(.98)}

    /* Matrix lock overlay */
    #matrixLock{
      position:fixed;
      inset:0;
      z-index:50;
      background:#000;
      display:flex;
      align-items:center;
      justify-content:center;
      flex-direction:column;
      gap:14px;
    }
    #matrixCanvas{
      position:absolute; inset:0;
      width:100%; height:100%;
      opacity:.45;
    }
    .lockUI{
      position:relative;
      z-index:52;
      text-align:center;
      padding:22px 18px;
      border-radius:18px;
      border:1px solid rgba(0,243,255,.30);
      background:rgba(0,0,0,.55);
      box-shadow:0 0 28px rgba(0,243,255,.16);
      width:min(520px, 92vw);
    }
    .lockUI h3{
      margin:0 0 10px 0;
      font-family:var(--fontHead);
      letter-spacing:.22em;
      font-weight:900;
      font-size:20px;
      color:var(--cyan);
    }
    .lockUI p{
      margin:0 0 14px 0;
      font-family:var(--fontMono);
      color:rgba(233,251,255,.75);
      font-size:12px;
      line-height:1.4;
    }
    .lockRow{
      display:flex; gap:10px;
      justify-content:center;
      flex-wrap:wrap;
    }
    .lockRow input{
      width:160px;
      text-align:center;
    }
    .hint{
      margin-top:12px;
      font-size:11px;
      color:rgba(233,251,255,.60);
      font-family:var(--fontMono);
    }
    .kbd{
      display:inline-block;
      padding:2px 8px;
      border:1px solid rgba(0,243,255,.20);
      border-radius:10px;
      background:rgba(0,0,0,.35);
      color:#fff;
      margin:0 4px;
    }
  </style>
</head>

<body>
  <canvas id="starmap"></canvas>
  <div class="scanline"></div>

  <!-- MATRIX LOCK -->
  <section id="matrixLock" aria-label="Matrix Lock Screen">
    <canvas id="matrixCanvas"></canvas>
    <div class="lockUI">
      <h3>CEC-WAM LOCKED</h3>
      <p>Matrix lock active. Enter authorization code to initialize EVE console and unlock the star-map UI.</p>
      <div class="lockRow">
        <input id="unlockCode" placeholder="CODE" inputmode="numeric" maxlength="8" class="btn" style="text-transform:none; letter-spacing:.2em;" />
        <button class="btn primary" onclick="unlock()">UNLOCK</button>
        <button class="btn" onclick="toggleVoice()">VOICE</button>
      </div>
      <div class="hint">
        Commands later use <span class="kbd">/</span> prefix. Questions are plain text. Code default: <span class="kbd">1010</span>
      </div>
    </div>
  </section>

  <div class="app">
    <!-- HEADER -->
    <header class="header">
      <div class="toprow">
        <div class="title">
          <h1>EVE Live Brain <span style="color:var(--cyan2); font-weight:900;">CEC-WAM INTERFACE</span></h1>
          <div class="sub">Project Valkyrie · Real-time Extraction · <span id="syncText">SYNC: 0%</span></div>
        </div>

        <div class="statsRow">
          <div class="statBox">
            <div class="statLabel">Net Liquidity</div>
            <div class="statValue">$<span id="netLiquidity">1,250,039</span></div>
          </div>
          <div class="statBox">
            <div class="statLabel">PSI Mass</div>
            <div class="statValue"><span id="psiMass">176,452.66</span></div>
          </div>
        </div>
      </div>

      <div class="statusLine">
        <div class="pill"><span class="dot green"></span><span id="statusText">STATUS: OPTIMAL (GOD_MODE)</span></div>
        <div class="pill"><span class="dot cyan"></span><span id="timeText">—</span></div>
        <div class="pill"><span class="dot purple"></span><span id="modeText">EVE: READY</span></div>
      </div>
    </header>

    <!-- TABS -->
    <nav class="tabs" role="tablist" aria-label="CEC-WAM Tabs">
      <div class="tab active" data-tab="dashboard" onclick="showTab('dashboard')">Dashboard</div>
      <div class="tab" data-tab="psi" onclick="showTab('psi')">PSI Coin <small>(Formulas)</small></div>
      <div class="tab" data-tab="ships" onclick="showTab('ships')">Ship Generation <small>(Blueprints)</small></div>
      <div class="tab" data-tab="tech" onclick="showTab('tech')">Tech & Upgrades</div>
      <div class="tab" data-tab="timeline" onclick="showTab('timeline')">Timeline & Logs</div>
      <div class="tab" data-tab="console" onclick="showTab('console')">EVE Console</div>
    </nav>

    <!-- MAIN -->
    <main class="main">

      <!-- DASHBOARD -->
      <section class="tabPane" id="tab-dashboard">
        <div class="panel">
          <h2>Core Metrics</h2>

          <div class="grid2">
            <div class="card">
              <div class="metricBig">
                <div>
                  <div class="k">Total Mass</div>
                  <div class="v"><span id="totalMass">100,001.33</span></div>
                  <div class="s"><span style="color:var(--green); font-weight:800;">Perfect</span></div>
                </div>
                <div style="text-align:right">
                  <div class="k">Dark Energy Index</div>
                  <div class="v" style="font-size:38px"><span id="darkEnergy">0.999</span></div>
                  <div class="s"><span style="color:var(--green); font-weight:800;">Stable</span></div>
                </div>
              </div>

              <div class="metricLine"><span>Black Hole Flow Rate</span><span><b id="bhFlow">1.33</b></span></div>
              <div class="metricLine"><span>R-Ratio Efficiency</span><span><b id="rRatio">10.96</b> <span style="color:var(--green)">1096%</span></span></div>
              <div class="metricLine"><span>BTC Allowance</span><span><b id="btcAllowance">1.33</b></span></div>
              <div class="metricLine"><span>AGI Timeline</span><span><b id="agiTimeline">Q4 2026</b> <span style="color:var(--gold)">90% CI</span></span></div>
            </div>

            <div class="card">
              <div class="cardTitle">
                <span>Resource Utilization</span>
                <span class="tag">Storage / Capacity</span>
              </div>

              <div class="donutWrap">
                <div class="donut" id="donut" style="--p:98.75">
                  <div class="donutCenter">
                    <div class="pct"><span id="usedPct">98.75</span>%</div>
                    <div class="lbl">USED</div>
                  </div>
                </div>
                <div class="legend">
                  <div class="legendRow">
                    <span><span class="swatch" style="background:var(--cyan)"></span>Used</span>
                    <span><b id="usedPct2">98.75%</b></span>
                  </div>
                  <div class="legendRow">
                    <span><span class="swatch" style="background:var(--purple)"></span>Left</span>
                    <span><b id="leftPct">1.25%</b></span>
                  </div>
                  <div class="legendRow">
                    <span>As of</span>
                    <span><b id="asOf">Nov 30, 2025</b></span>
                  </div>
                </div>
              </div>

              <div style="margin-top:12px" class="muted">
                System operates near capacity. Use <b>/reset</b> to clear old local storage, then <b>/sync</b>.
              </div>
            </div>
          </div>
        </div>

        <div class="panel">
          <h2>PSI Bonding Curve</h2>
          <div class="grid2">
            <div class="card">
              <div class="cardTitle"><span>Curve Pressure</span><span class="tag">Gauge</span></div>
              <div class="donutWrap">
                <div class="donut" id="psiGauge" style="--p:0">
                  <div class="donutCenter">
                    <div class="pct"><span id="psiGaugePct">0</span>%</div>
                    <div class="lbl">BONDING</div>
                  </div>
                </div>
                <div class="legend">
                  <div class="legendRow">
                    <span>Needed</span>
                    <span><b id="neededUSD">$56,363</b></span>
                  </div>
                  <div class="legendRow">
                    <span>Instruction</span>
                    <span style="color:var(--red); font-weight:900;">SIMULATED UI</span>
                  </div>
                  <div class="legendRow">
                    <span>Tip</span>
                    <span>Use <b>/set needed_usd 10000</b></span>
                  </div>
                </div>
              </div>
              <div class="muted" style="margin-top:10px">
                This panel is a visualization control only. It does not execute financial transfers.
              </div>
            </div>

            <div class="card">
              <div class="cardTitle"><span>Quick Commands</span><span class="tag">Console</span></div>
              <div class="desc">
                <b>/help</b> list commands<br/>
                <b>/tab ships</b> open Ship Generation<br/>
                <b>/sync</b> pull live.json<br/>
                <b>/formulas</b> show all 10 formulas<br/>
                <b>/reset</b> clear old data storage (local) and reload
              </div>
            </div>
          </div>
        </div>
      </section>

      <!-- PSI COIN -->
      <section class="tabPane" id="tab-psi" style="display:none">
        <div class="panel">
          <h2>PSI Coin Overview</h2>
          <p class="muted">Sovereign crypto asset driving CEC-WAM. Values are pulled from live.json (or last cached state).</p>

          <div class="grid2">
            <div class="card">
              <div class="metricLine"><span>Total PSI Minted</span><span><b id="psiMinted">200</b> <span style="color:var(--purple)">Minted</span></span></div>
              <div class="metricLine"><span>Current Valuation</span><span><b id="valuation">$34.1M</b> <span style="color:var(--green)">Verified</span></span></div>
              <div class="metricLine"><span>Escrow Status</span><span><b id="escrow">84%</b> <span style="color:var(--green)">Omega Lock</span></span></div>
            </div>

            <div class="card">
              <div class="cardTitle"><span>Security & Network</span><span class="tag">Live</span></div>
              <div class="desc">
                Network Load: <b><span id="netLoad">43%</span></b> <span style="color:var(--green)">(Stable)</span><br/>
                Latency: <b><span id="latency">12 ms</span></b> <span style="color:var(--green)">(Fast)</span><br/>
                Identity: <b>Sovereign Architect</b><br/>
                Access Level: <b>OMEGA — Authorized</b>
              </div>
            </div>
          </div>
        </div>

        <div class="panel">
          <h2>10 Formulas (Built-in)</h2>
          <p class="muted">Use <b>/formulas</b> in the EVE Console to print them, or <b>/calc</b> to recompute now.</p>
          <div class="card">
            <div id="formulaList" class="desc"></div>
          </div>
        </div>
      </section>

      <!-- SHIP GENERATION -->
      <section class="tabPane" id="tab-ships" style="display:none">
        <div class="panel">
          <h2>Ship Generation</h2>
          <p class="muted">Blueprint-labeled, color-coded. If images are missing, blueprint fallback renders automatically (no “?”).</p>

          <div class="grid2">
            <div class="card">
              <div class="cardTitle">
                <span style="color:var(--cyan)">Quantum Core</span>
                <span class="tag">CORE · CYAN</span>
              </div>
              <div class="media">
                <img id="imgQuantum" alt="Quantum Core" src="assets/quantum-core.webp" />
                <div class="bp" id="bpQuantum">
                  <svg viewBox="0 0 800 450" xmlns="http://www.w3.org/2000/svg">
                    <defs>
                      <pattern id="grid" width="24" height="24" patternUnits="userSpaceOnUse">
                        <path d="M 24 0 L 0 0 0 24" fill="none" stroke="rgba(0,243,255,.18)" stroke-width="1"/>
                      </pattern>
                    </defs>
                    <rect width="800" height="450" fill="url(#grid)"/>
                    <circle cx="400" cy="225" r="140" fill="none" stroke="rgba(0,243,255,.55)" stroke-width="4"/>
                    <circle cx="400" cy="225" r="95" fill="none" stroke="rgba(188,19,254,.45)" stroke-width="3" stroke-dasharray="8 10"/>
                    <rect x="160" y="90" width="480" height="270" rx="18" fill="none" stroke="rgba(0,243,255,.38)" stroke-width="3"/>
                    <path d="M160 225 H640" stroke="rgba(0,243,255,.25)" stroke-width="2"/>
                    <path d="M400 90 V360" stroke="rgba(0,243,255,.25)" stroke-width="2"/>
                    <text x="26" y="36" fill="rgba(233,251,255,.75)" font-family="monospace" font-size="14">QC-01 · MOTHERBOARD CORE · BLUEPRINT MODE</text>
                    <text x="520" y="420" fill="rgba(233,251,255,.75)" font-family="monospace" font-size="14">PINMAP: 48 · BUS: 9 · FIELD: STABLE</text>
                  </svg>
                </div>
              </div>
              <div class="desc">
                <b>Quantum Core Computer</b><br/>
                Hyper-realistic top-down core blueprint with labeled rails and stability overlays.
              </div>
            </div>

            <div class="card">
              <div class="cardTitle">
                <span style="color:var(--purple)">Drone Ship</span>
                <span class="tag">FLEET · PURPLE</span>
              </div>
              <div class="media">
                <img id="imgDrone" alt="Drone Ship" src="assets/drone-ship.webp" />
                <div class="bp" id="bpDrone">
                  <svg viewBox="0 0 800 450" xmlns="http://www.w3.org/2000/svg">
                    <rect width="800" height="450" fill="rgba(0,0,0,.12)"/>
                    <path d="M120 260 C220 160, 320 140, 400 130 C480 140, 580 160, 680 260
                             C600 290, 520 310, 400 320 C280 310, 200 290, 120 260 Z"
                          fill="none" stroke="rgba(0,243,255,.55)" stroke-width="4"/>
                    <path d="M220 250 L300 190 L400 170 L500 190 L580 250"
                          fill="none" stroke="rgba(188,19,254,.55)" stroke-width="3" stroke-dasharray="10 8"/>
                    <circle cx="400" cy="235" r="18" fill="none" stroke="rgba(255,215,0,.55)" stroke-width="3"/>
                    <line x1="400" y1="235" x2="740" y2="90" stroke="rgba(233,251,255,.45)" stroke-width="2"/>
                    <text x="752" y="92" fill="rgba(233,251,255,.80)" font-family="monospace" font-size="14">THRUSTER NODE</text>
                    <text x="26" y="36" fill="rgba(233,251,255,.75)" font-family="monospace" font-size="14">DR-07 · WIRE-FRAME SCHEMATIC · TACTICAL OVERLAY</text>
                  </svg>
                </div>
              </div>
              <div class="desc">
                <b>Drone Ship Prototype</b><br/>
                3D wireframe schematic with labeled thruster and hull geometry.
              </div>
            </div>

            <div class="card">
              <div class="cardTitle">
                <span style="color:var(--gold)">Neural Interface</span>
                <span class="tag">LINK · GOLD</span>
              </div>
              <div class="media">
                <img id="imgNeural" alt="Neural Interface" src="assets/neural-interface.webp" />
                <div class="bp" id="bpNeural">
                  <svg viewBox="0 0 800 450" xmlns="http://www.w3.org/2000/svg">
                    <defs>
                      <radialGradient id="g" cx="50%" cy="50%" r="60%">
                        <stop offset="0%" stop-color="rgba(255,215,0,.18)"/>
                        <stop offset="70%" stop-color="rgba(0,243,255,.10)"/>
                        <stop offset="100%" stop-color="rgba(0,0,0,0)"/>
                      </radialGradient>
                    </defs>
                    <rect width="800" height="450" fill="rgba(0,0,0,.12)"/>
                    <circle cx="320" cy="225" r="130" fill="url(#g)"/>
                    <circle cx="520" cy="225" r="130" fill="url(#g)"/>
                    <path d="M320 225 C380 160, 460 160, 520 225 C460 290, 380 290, 320 225 Z"
                          fill="none" stroke="rgba(255,215,0,.55)" stroke-width="4"/>
                    <g stroke="rgba(0,243,255,.35)" stroke-width="2">
                      <line x1="260" y1="180" x2="200" y2="120"/>
                      <line x1="260" y1="270" x2="200" y2="330"/>
                      <line x1="580" y1="180" x2="640" y2="120"/>
                      <line x1="580" y1="270" x2="640" y2="330"/>
                    </g>
                    <text x="26" y="36" fill="rgba(233,251,255,.75)" font-family="monospace" font-size="14">NI-02 · SYNAPTIC BRIDGE · PARTICLE LINK MAP</text>
                    <text x="520" y="420" fill="rgba(233,251,255,.75)" font-family="monospace" font-size="14">LATENCY: LOW · INTEGRITY: HIGH</text>
                  </svg>
                </div>
              </div>
              <div class="desc">
                <b>Brain-to-System Sync</b><br/>
                Neural bridge schematic with labeled signal rails and integrity markers.
              </div>
            </div>

            <div class="card">
              <div class="cardTitle">
                <span style="color:var(--green)">Star Map Overlay</span>
                <span class="tag">MAP · GREEN</span>
              </div>
              <div class="media">
                <div class="bp">
                  <svg viewBox="0 0 800 450" xmlns="http://www.w3.org/2000/svg">
                    <rect width="800" height="450" fill="rgba(0,0,0,.12)"/>
                    <g fill="rgba(0,243,255,.9)">
                      <circle cx="120" cy="90" r="2"/><circle cx="240" cy="60" r="1.8"/><circle cx="340" cy="120" r="2.2"/>
                      <circle cx="520" cy="80" r="1.7"/><circle cx="670" cy="130" r="2.1"/><circle cx="720" cy="70" r="1.5"/>
                      <circle cx="160" cy="320" r="1.9"/><circle cx="280" cy="360" r="1.6"/><circle cx="420" cy="320" r="2.0"/>
                      <circle cx="590" cy="350" r="1.8"/><circle cx="710" cy="310" r="2.2"/>
                    </g>
                    <g stroke="rgba(51,255,102,.55)" stroke-width="2" fill="none">
                      <path d="M120 90 L240 60 L340 120 L520 80 L670 130 L720 70"/>
                      <path d="M160 320 L280 360 L420 320 L590 350 L710 310"/>
                    </g>
                    <text x="26" y="36" fill="rgba(233,251,255,.75)" font-family="monospace" font-size="14">SM-LOCK · MATRIX + STARFIELD · NAV ROUTES</text>
                  </svg>
                </div>
              </div>
              <div class="desc">
                <b>Integrated star map</b> runs behind everything. Matrix lock is the front gate.
              </div>
            </div>

          </div>
        </div>
      </section>

      <!-- TECH -->
      <section class="tabPane" id="tab-tech" style="display:none">
        <div class="panel">
          <h2>Technology & Upgrades</h2>
          <p class="muted">Future-tech descriptions and labeled modules. (Pure UI; safe to host publicly.)</p>

          <div class="card" style="margin-bottom:12px">
            <div class="cardTitle"><span>5D Visualization Engine</span><span class="tag">CYAN</span></div>
            <div class="desc">Upgraded star-map renderer supports multi-dimensional projections for immersive navigation through layered datasets.</div>
          </div>

          <div class="card" style="margin-bottom:12px">
            <div class="cardTitle"><span>Quantum AI Core</span><span class="tag">PURPLE</span></div>
            <div class="desc">Predictive analysis module + self-healing logic hooks. (If you later add a backend, this console becomes the UI front-end.)</div>
          </div>

          <div class="card" style="margin-bottom:12px">
            <div class="cardTitle"><span>Self-Healing OS</span><span class="tag">GREEN</span></div>
            <div class="desc">Detects anomalies in real time, routes alerts to EVE console, supports reset/restore flows.</div>
          </div>

          <div class="card">
            <div class="cardTitle"><span>Holographic Desk Interface</span><span class="tag">GOLD</span></div>
            <div class="desc">Glass panels + neon rails. Tabs are color-coded to match module class: CYAN(core), PURPLE(fleet), GOLD(link), GREEN(map/security).</div>
          </div>
        </div>
      </section>

      <!-- TIMELINE -->
      <section class="tabPane" id="tab-timeline" style="display:none">
        <div class="panel">
          <h2>Timeline & Audit Logs</h2>
          <p class="muted">Chronological record (editable in <code>data/live.json</code>).</p>

          <div class="card" style="margin-bottom:12px">
            <div class="desc" id="timelineList"></div>
          </div>

          <div class="card">
            <div class="cardTitle"><span>System Logs</span><span class="tag">TABLE</span></div>
            <table>
              <thead>
                <tr><th>Category</th><th>Metric</th><th>Value</th><th>Status</th></tr>
              </thead>
              <tbody id="sysTable"></tbody>
            </table>
          </div>
        </div>
      </section>

      <!-- CONSOLE -->
      <section class="tabPane" id="tab-console" style="display:none">
        <div class="panel">
          <h2>EVE Console</h2>
          <p class="muted">Rules: commands start with <b>/</b>. Questions are plain text. Every input gets a response.</p>

          <div class="consoleWrap">
            <div class="log" id="log"></div>

            <div class="inputRow">
              <input id="cmd" placeholder="Type: /help  OR  ask a question..." autocomplete="off" />
              <button class="btn primary" onclick="submit()">SEND</button>
              <button class="btn" onclick="runCmd('sync')">SYNC</button>
              <button class="btn danger" onclick="runCmd('reset')">RESET</button>
            </div>

            <div class="muted" style="font-family:var(--fontMono); font-size:12px">
              Voice (optional): click VOICE on lock screen, or type <b>/voice</b> here.
            </div>
          </div>
        </div>
      </section>

    </main>
  </div>

<script>
  /***********************
   * STATE + LIVE SYNC
   ***********************/
  const DEFAULT_STATE = {
    auth_code: "1010",
    sync: 0,
    net_liquidity: 1250039,
    psi_mass: 176452.66,

    total_mass: 100001.33,
    dark_energy_index: 0.999,
    black_hole_flow_rate: 1.33,
    r_ratio_efficiency: 10.96,
    btc_allowance: 1.33,
    agi_timeline: "Q4 2026",
    agi_ci: 0.90,

    resource_used_pct: 98.75,
    resource_left_pct: 1.25,
    as_of: "Nov 30, 2025",

    psi_minted: 200,
    valuation_usd: 34100000,
    escrow_pct: 84,
    network_load_pct: 43,
    latency_ms: 12,

    needed_usd: 56363,
    psi_gauge_pct: 0,

    timeline: [
      "Nov 27 2025: Resource conflict (T-3) detected and resolved via mutex lock.",
      "Nov 30 2025: Global synchronization finished; BTC allowance transfer verified (1.33 BTC).",
      "Dec 2 2025: Ghost Protocol executed, activating expendable funds.",
      "Dec 12 2025: Master Archive generated — patent and copyrights registered.",
      "Jan 8 2026: Incoming asset recorded: +176,452.66 PSI tokens; net worth validated at ~176M (display only).",
      "Jan 16 2026: CEC Matrix metrics updated — valuation $34.1M; escrow status 84%; security status OMEGA_LOCK.",
      "Today: System operating in GOD_MODE with 99.9% focus; star map visuals upgraded."
    ],
    syslogs: [
      ["Finance","Valuation","$1.25M","Verified"],
      ["Finance","PSI-Coins","200 PSI","Minted"],
      ["System","Mode","GOD_MODE","Optimal"],
      ["Network","Load","43%","Stable"],
      ["Network","Latency","12ms","Fast"],
      ["Security","Identity","Sovereign Architect","Encrypted"]
    ]
  };

  // Local cache key
  const CACHE_KEY = "cecwam_state_v3";
  const DATA_URL = "./data/live.json"; // optional: create this file in your repo (see below)

  let state = loadCached() || structuredClone(DEFAULT_STATE);

  /***********************
   * 10 FORMULAS
   ***********************/
  const CONST = {
    c: 299792458,              // m/s
    G: 6.67430e-11,            // m^3 kg^-1 s^-2
    hbar: 1.054571817e-34,     // J*s
    kB: 1.380649e-23,          // J/K
    pi: Math.PI,
    phi: 1.61803398875,
    OmegaL: 0.685,
    OmegaM: 0.315,
    H0: 67.4,                  // km/s/Mpc (display-level)
    Lambda: 1.1056e-52         // m^-2 (display-level)
  };

  const FORMULAS = [
    {name:"F1 · PSI (Λ·c²/3)", fn:()=> (CONST.Lambda * CONST.c * CONST.c) / 3 },
    {name:"F2 · Dark Energy Index (ΩΛ)", fn:()=> CONST.OmegaL },
    {name:"F3 · Matter Index (Ωm)", fn:()=> CONST.OmegaM },
    {name:"F4 · Φ Ratio (Golden)", fn:()=> CONST.phi },
    {name:"F5 · Entropy Seed (Φ + ε)", fn:()=> CONST.phi + (Math.random()*0.001) },
    {name:"F6 · Stability Score (1 - |ΩΛ-0.685|)", fn:()=> 1 - Math.abs(CONST.OmegaL - 0.685) },
    {name:"F7 · Resource Headroom (100-used)", fn:()=> 100 - state.resource_used_pct },
    {name:"F8 · Liquidity / PSI Mass", fn:()=> state.net_liquidity / state.psi_mass },
    {name:"F9 · R-Ratio (% proxy)", fn:()=> state.r_ratio_efficiency * 100 },
    {name:"F10 · Latency Quality (1/(1+ms))", fn:()=> 1 / (1 + state.latency_ms) },
  ];

  function renderFormulas(){
    const el = document.getElementById("formulaList");
    el.innerHTML = FORMULAS.map(f=>{
      let v = f.fn();
      let out = (Math.abs(v) >= 1e6 || Math.abs(v) <= 1e-3) ? v.toExponential(6) : v.toFixed(6);
      return `${escapeHtml(f.name)} = <b>${out}</b>`;
    }).join("<br/>");
  }

  /***********************
   * UI RENDER
   ***********************/
  function fmtInt(x){ return Number(x).toLocaleString(); }
  function fmtMoney(x){
    const n = Number(x);
    if (n >= 1e9) return "$" + (n/1e9).toFixed(1) + "B";
    if (n >= 1e6) return "$" + (n/1e6).toFixed(1) + "M";
    return "$" + n.toLocaleString();
  }

  function applyState(){
    document.getElementById("timeText").textContent = new Date().toLocaleString();
    document.getElementById("syncText").textContent = `SYNC: ${state.sync}%`;

    document.getElementById("netLiquidity").textContent = fmtInt(state.net_liquidity);
    document.getElementById("psiMass").textContent = Number(state.psi_mass).toLocaleString(undefined,{maximumFractionDigits:2});

    document.getElementById("totalMass").textContent = Number(state.total_mass).toLocaleString(undefined,{maximumFractionDigits:2});
    document.getElementById("darkEnergy").textContent = Number(state.dark_energy_index).toFixed(3);
    document.getElementById("bhFlow").textContent = Number(state.black_hole_flow_rate).toFixed(2);
    document.getElementById("rRatio").textContent = Number(state.r_ratio_efficiency).toFixed(2);
    document.getElementById("btcAllowance").textContent = Number(state.btc_allowance).toFixed(2);
    document.getElementById("agiTimeline").textContent = state.agi_timeline;

    // Resource donut
    const used = Number(state.resource_used_pct);
    const left = Number(state.resource_left_pct);
    document.getElementById("donut").style.setProperty("--p", used);
    document.getElementById("usedPct").textContent = used.toFixed(2);
    document.getElementById("usedPct2").textContent = used.toFixed(2) + "%";
    document.getElementById("leftPct").textContent = left.toFixed(2) + "%";
    document.getElementById("asOf").textContent = state.as_of;

    // PSI gauge
    const gp = Number(state.psi_gauge_pct || 0);
    document.getElementById("psiGauge").style.setProperty("--p", gp);
    document.getElementById("psiGaugePct").textContent = gp.toFixed(0);
    document.getElementById("neededUSD").textContent = fmtMoney(state.needed_usd);

    // PSI Coin tab
    document.getElementById("psiMinted").textContent = fmtInt(state.psi_minted);
    document.getElementById("valuation").textContent = fmtMoney(state.valuation_usd);
    document.getElementById("escrow").textContent = Number(state.escrow_pct).toFixed(0) + "%";
    document.getElementById("netLoad").textContent = Number(state.network_load_pct).toFixed(0) + "%";
    document.getElementById("latency").textContent = Number(state.latency_ms).toFixed(0) + " ms";

    // Timeline
    document.getElementById("timelineList").innerHTML =
      "<ul style='margin:0; padding-left:18px; line-height:1.4'>" +
      state.timeline.map(x=>`<li>${escapeHtml(x)}</li>`).join("") +
      "</ul>";

    // System log table
    const tbody = document.getElementById("sysTable");
    tbody.innerHTML = "";
    for(const row of state.syslogs){
      const tr = document.createElement("tr");
      const status = row[3] || "";
      let cls = "statusInfo";
      if(String(status).toLowerCase().includes("opt")) cls="statusOK";
      if(String(status).toLowerCase().includes("ver")) cls="statusOK";
      if(String(status).toLowerCase().includes("mint")) cls="statusInfo";
      if(String(status).toLowerCase().includes("enc")) cls="statusWarn";
      tr.innerHTML = `<td>${escapeHtml(row[0])}</td><td>${escapeHtml(row[1])}</td><td>${escapeHtml(row[2])}</td><td class="${cls}">${escapeHtml(status)}</td>`;
      tbody.appendChild(tr);
    }

    // Ship image fallback: show img if it loads, otherwise blueprint stays
    bindImg("imgQuantum","bpQuantum");
    bindImg("imgDrone","bpDrone");
    bindImg("imgNeural","bpNeural");

    renderFormulas();
  }

  function bindImg(imgId, bpId){
    const img = document.getElementById(imgId);
    const bp = document.getElementById(bpId);
    if(!img) return;
    img.onload = ()=>{ img.style.display="block"; if(bp) bp.style.display="none"; };
    img.onerror = ()=>{ img.style.display="none"; if(bp) bp.style.display="flex"; };
    // If cached already loaded
    if(img.complete && img.naturalWidth > 0){ img.onload(); }
  }

  /***********************
   * TABS
   ***********************/
  function showTab(name){
    document.querySelectorAll(".tab").forEach(t=>{
      t.classList.toggle("active", t.dataset.tab === name);
    });
    document.querySelectorAll(".tabPane").forEach(p=>p.style.display="none");
    const pane = document.getElementById("tab-" + name);
    if(pane) pane.style.display = "block";
    logSYS(`TAB → ${name.toUpperCase()}`);
  }

  /***********************
   * EVE CONSOLE: COMMAND vs TALK
   ***********************/
  const logEl = ()=>document.getElementById("log");

  function nowTS(){
    const d = new Date();
    return d.toLocaleTimeString([], {hour:'2-digit', minute:'2-digit', second:'2-digit'});
  }

  function logLine(src, msg){
    const line = document.createElement("div");
    line.className="logLine";
    const cls = src==="EVE" ? "srcEVE" : src==="YOU" ? "srcYOU" : src==="ERR" ? "srcERR" : "srcSYS";
    line.innerHTML = `<span class="ts">[${nowTS()}]</span> <span class="${cls}">${src}:</span> ${escapeHtml(msg)}`;
    logEl().appendChild(line);
    logEl().scrollTop = logEl().scrollHeight;
  }
  function logSYS(m){ logLine("SYS", m); }
  function logYOU(m){ logLine("YOU", m); }
  function logEVE(m){ logLine("EVE", m); }
  function logERR(m){ logLine("ERR", m); }

  function submit(){
    const input = document.getElementById("cmd");
    const raw = (input.value || "").trim();
    if(!raw) return;
    input.value="";
    handleInput(raw);
  }

  function handleInput(raw){
    logYOU(raw);

    // Auto-detect:
    // - If starts with / or ! => command
    // - Else => talk/question
    if(raw.startsWith("/") || raw.startsWith("!")){
      const cmd = raw.replace(/^[/!]+/,"");
      runCmd(cmd);
      return;
    }

    // Talk mode: always respond (offline rules)
    respondTalk(raw);
  }

  function respondTalk(text){
    const t = text.toLowerCase();

    // If user is actually asking for a command but forgot "/", be helpful
    if(t.includes("sync")) return logEVE("If you meant the command, use /sync. If you meant a question, ask what you want synced from.");
    if(t.includes("reset") || t.includes("clear")) return logEVE("To clear old local data storage: use /reset (this reloads and wipes cached state).");
    if(t.includes("tab") || t.includes("open")) return logEVE("To switch tabs: /tab dashboard | psi | ships | tech | timeline | console");

    // Normal Q/A (offline)
    if(t.endsWith("?")){
      return logEVE("I’m in offline mode on GitHub Pages. I can control UI + formulas + sync. For full AI answers inside the board, add a backend endpoint later. For now use /help.");
    }

    // Default: acknowledge + suggestion
    logEVE("Acknowledged. If you want an action, use /help for the command list. If you want a question answered, add '?' at the end.");
  }

  function runCmd(cmdLine){
    const parts = cmdLine.trim().split(/\s+/);
    const cmd = (parts[0]||"").toLowerCase();
    const args = parts.slice(1);

    switch(cmd){
      case "help":
        logEVE("Commands: /help, /status, /tab <name>, /sync, /export, /formulas, /calc, /set <key> <value>, /lock, /voice, /reset");
        break;

      case "status":
        logEVE(`STATUS: OPTIMAL. SYNC=${state.sync}%. NET=$${fmtInt(state.net_liquidity)} PSI=${Number(state.psi_mass).toFixed(2)} LOAD=${state.network_load_pct}%`);
        break;

      case "tab":
        showTab((args[0]||"dashboard").toLowerCase());
        logEVE(`Tab switched → ${String(args[0]||"dashboard").toUpperCase()}`);
        break;

      case "sync":
        syncLive(true);
        break;

      case "export":
        exportState();
        logEVE("Exported current state as a JSON download.");
        break;

      case "formulas":
        logEVE("Printing 10 formulas to console…");
        FORMULAS.forEach(f=>{
          const v = f.fn();
          const out = (Math.abs(v) >= 1e6 || Math.abs(v) <= 1e-3) ? v.toExponential(6) : v.toFixed(6);
          logSYS(`${f.name} = ${out}`);
        });
        break;

      case "calc":
        renderFormulas();
        logEVE("Recomputed formulas and refreshed PSI tab.");
        break;

      case "set":
        if(args.length < 2){
          logERR("Usage: /set <key> <value>");
          break;
        }
        {
          const key = args[0];
          const valRaw = args.slice(1).join(" ");
          const num = Number(valRaw.replace(/[$,%]/g,""));
          state[key] = Number.isFinite(num) ? num : valRaw;
          state.sync = 100;
          saveCached(state);
          applyState();
          logEVE(`Set ${key} = ${state[key]}`);
        }
        break;

      case "lock":
        lock();
        logEVE("Matrix lock engaged.");
        break;

      case "voice":
        toggleVoice();
        break;

      case "reset":
        factoryReset();
        break;

      default:
        logEVE(`Unknown command: "${cmd}". Use /help.`);
    }
  }

  /***********************
   * CACHE + RESET
   ***********************/
  function saveCached(obj){
    try{
      localStorage.setItem(CACHE_KEY, JSON.stringify({t:Date.now(), v:obj}));
    }catch(e){}
  }

  function loadCached(){
    try{
      const raw = localStorage.getItem(CACHE_KEY);
      if(!raw) return null;
      const parsed = JSON.parse(raw);
      return parsed && parsed.v ? parsed.v : null;
    }catch(e){ return null; }
  }

  async function factoryReset(){
    logSYS("RESET: clearing local storage + cache (best effort)...");
    try{
      localStorage.removeItem(CACHE_KEY);
      // Cache API (only if service worker/caches exist)
      if("caches" in window){
        const keys = await caches.keys();
        await Promise.all(keys.map(k=>caches.delete(k)));
      }
    }catch(e){}
    location.reload();
  }

  /***********************
   * LIVE.JSON SYNC
   ***********************/
  async function syncLive(verbose=false){
    if(verbose) logSYS("SYNC: fetching live.json …");
    try{
      const res = await fetch(DATA_URL + "?t=" + Date.now(), {cache:"no-store"});
      if(!res.ok) throw new Error("HTTP " + res.status);
      const incoming = await res.json();

      // Merge on top of state
      state = {...state, ...incoming};
      state.sync = 100;

      saveCached(state);
      applyState();
      if(verbose) logEVE("Sync complete. State updated from live.json.");
    }catch(e){
      state.sync = Math.max(0, state.sync - 20);
      applyState();
      if(verbose) logERR("Sync failed. Using last cached/default state. Tip: create /data/live.json in repo.");
    }
  }

  function exportState(){
    const blob = new Blob([JSON.stringify(state,null,2)], {type:"application/json"});
    const a = document.createElement("a");
    a.href = URL.createObjectURL(blob);
    a.download = "cecwam_state_export.json";
    document.body.appendChild(a);
    a.click();
    a.remove();
  }

  /***********************
   * MATRIX LOCK + VOICE
   ***********************/
  let recognition = null;
  let voiceOn = false;

  function unlock(){
    const code = (document.getElementById("unlockCode").value || "").trim();
    const ok = (code === state.auth_code) || (code === "1010");
    if(!ok){
      logERR("LOCK: invalid authorization code.");
      return;
    }
    document.getElementById("matrixLock").style.display="none";
    logSYS("UNLOCKED: Architect access confirmed.");
    logEVE("Online. Use /help. Use /sync to pull live.json.");
    showTab("dashboard");
  }

  function lock(){
    document.getElementById("matrixLock").style.display="flex";
  }

  function toggleVoice(){
    // Voice recognition availability varies by browser (iOS Safari often limited)
    const SR = window.SpeechRecognition || window.webkitSpeechRecognition;
    if(!SR){
      logERR("VOICE: SpeechRecognition not supported in this browser.");
      return;
    }

    if(!recognition){
      recognition = new SR();
      recognition.continuous = true;
      recognition.interimResults = false;
      recognition.onresult = (ev)=>{
        const txt = ev.results[ev.results.length-1][0].transcript.trim();
        // Voice always treated as TALK unless it starts with "slash"
        // You can say: "slash sync" to run /sync
        if(txt.toLowerCase().startsWith("slash ")){
          handleInput("/" + txt.slice(6));
        }else{
          handleInput(txt);
        }
      };
      recognition.onerror = ()=>{ logERR("VOICE: error. Try again."); };
      recognition.onend = ()=>{ if(voiceOn){ try{ recognition.start(); }catch(e){} } };
    }

    voiceOn = !voiceOn;
    if(voiceOn){
      try{
        recognition.start();
        logSYS("VOICE: listening… (Say: 'slash help' for /help)");
      }catch(e){
        logERR("VOICE: could not start (permission?).");
        voiceOn = false;
      }
    }else{
      try{ recognition.stop(); }catch(e){}
      logSYS("VOICE: stopped.");
    }
  }

  /***********************
   * STAR MAP BACKGROUND
   ***********************/
  const starCanvas = document.getElementById("starmap");
  const starCtx = starCanvas.getContext("2d");
  let stars = [];
  function resizeStars(){
    starCanvas.width = window.innerWidth * devicePixelRatio;
    starCanvas.height = window.innerHeight * devicePixelRatio;
    starCtx.setTransform(devicePixelRatio,0,0,devicePixelRatio,0,0);
    const n = Math.min(240, Math.floor((window.innerWidth * window.innerHeight)/7000));
    stars = Array.from({length:n}, ()=>({
      x: Math.random()*window.innerWidth,
      y: Math.random()*window.innerHeight,
      z: 0.4 + Math.random()*1.6,
      r: 0.6 + Math.random()*1.8,
      tw: Math.random()*Math.PI*2
    }));
  }
  function drawStars(){
    starCtx.clearRect(0,0,window.innerWidth, window.innerHeight);
    for(const s of stars){
      s.tw += 0.01*s.z;
      const a = 0.22 + 0.18*Math.sin(s.tw);
      starCtx.beginPath();
      starCtx.fillStyle = `rgba(0,243,255,${a})`;
      starCtx.arc(s.x, s.y, s.r, 0, Math.PI*2);
      starCtx.fill();

      // slow drift
      s.x += 0.05*s.z; s.y += 0.02*s.z;
      if(s.x > window.innerWidth+10) s.x = -10;
      if(s.y > window.innerHeight+10) s.y = -10;
    }
    requestAnimationFrame(drawStars);
  }

  /***********************
   * MATRIX RAIN (LOCK)
   ***********************/
  const mCanvas = document.getElementById("matrixCanvas");
  const mCtx = mCanvas.getContext("2d");
  let drops = [];
  function resizeMatrix(){
    mCanvas.width = window.innerWidth;
    mCanvas.height = window.innerHeight;
    const fontSize = 16;
    const cols = Math.floor(mCanvas.width / fontSize);
    drops = Array(cols).fill(1);
  }
  function drawMatrix(){
    const letters = "0101CEC-WAM0101";
    const fontSize = 16;
    mCtx.fillStyle = "rgba(0,0,0,0.06)";
    mCtx.fillRect(0,0,mCanvas.width,mCanvas.height);
    mCtx.fillStyle = "#0F0";
    mCtx.font = fontSize + "px monospace";
    drops.forEach((y, i)=>{
      const text = letters.charAt(Math.floor(Math.random()*letters.length));
      mCtx.fillText(text, i*fontSize, y*fontSize);
      if(y*fontSize > mCanvas.height && Math.random() > 0.975) drops[i]=0;
      drops[i]++;
    });
    requestAnimationFrame(drawMatrix);
  }

  /***********************
   * BOOT
   ***********************/
  function escapeHtml(s){
    return String(s).replace(/[&<>"']/g, m=>({ "&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;" }[m]));
  }

  window.addEventListener("resize", ()=>{
    resizeStars();
    resizeMatrix();
  });

  // Enter key in console
  document.addEventListener("keydown", (e)=>{
    if(e.key === "Enter"){
      const el = document.getElementById("cmd");
      const active = document.activeElement;
      if(active && active.id === "cmd") submit();
      if(active && active.id === "unlockCode") unlock();
    }
  });

  // Initial render
  (function init(){
    resizeStars(); drawStars();
    resizeMatrix(); drawMatrix();
    applyState();

    // Prime console
    showTab("dashboard");
    logSYS("BOOT: interface loaded.");
    logEVE("Awaiting unlock. Enter code 1010.");

    // Auto background sync attempt (safe, best effort)
    setInterval(()=>syncLive(false), 30000);
  })();
</script>
</body>
</html>

